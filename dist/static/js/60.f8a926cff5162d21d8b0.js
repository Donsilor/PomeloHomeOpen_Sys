webpackJsonp([60],{"+Nz3":function(t,e,i){var a=i("ru9S");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("3893cba9",a,!0)},"2fa7":function(t,e,i){"use strict";function a(t){i("+Nz3")}Object.defineProperty(e,"__esModule",{value:!0});var n=i("nF2r"),r=i("8nIN"),s=i("VU/8"),l=a,o=s(n.a,r.a,!1,l,"data-v-f776f52e",null);e.default=o.exports},"8nIN":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container calendar-list-container"},[i("el-row",{staticStyle:{"margin-bottom":"10px"}},[i("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.addFault}},[t._v("\n            新增方案\n        ")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.list,"element-loading-text":"给我一点时间",stripe:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"manufacturer",prop:"manufacturer"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"品类"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.getTypeTextById(e.row.cid)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"pid",prop:"product_id"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"code",prop:"code"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"status",prop:"status"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"des",prop:"des"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"是否有效"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.is_valid?i("el-tag",{attrs:{type:"success"}},[t._v("有效")]):i("el-tag",{attrs:{type:"info"}},[t._v("已删除")])]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.is_valid?i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(i){t.editFault(e.row,!0)}}},[t._v("编辑")]):t._e(),t._v(" "),e.row.is_valid?i("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(i){t.deleteFault(e.row)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.listLoading,expression:"!listLoading"}],staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[15,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.listQuery,"page",e)}}})],1),t._v(" "),i("el-dialog",{attrs:{visible:t.formVisible,title:t.dialogTitle},on:{"update:visible":function(e){t.formVisible=e}}},[i("el-form",{attrs:{"label-width":"120px"}},[i("el-form-item",{attrs:{label:"品类"}},[i("el-select",{attrs:{disabled:t.isEdit},on:{change:t.onTypeChange},model:{value:t.formItem.cid,callback:function(e){t.$set(t.formItem,"cid",e)},expression:"formItem.cid"}},t._l(t.typeList,function(t){return i("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})}))],1),t._v(" "),i("el-form-item",{attrs:{label:"品牌"}},[i("el-select",{attrs:{disabled:t.isEdit},on:{change:t.onBrandChange},model:{value:t.formItem.manufacturer,callback:function(e){t.$set(t.formItem,"manufacturer",e)},expression:"formItem.manufacturer"}},t._l(t.manufacturerList,function(t,e){return i("el-option",{key:e,attrs:{label:t.manufacturer_name,value:t.manufacturer_name}})}))],1),t._v(" "),i("el-form-item",{attrs:{label:"product_id"}},[i("el-select",{attrs:{clearable:""},model:{value:t.formItem.product_id,callback:function(e){t.$set(t.formItem,"product_id",e)},expression:"formItem.product_id"}},t._l(t.productList,function(t){return i("el-option",{key:t.product_id,attrs:{value:t.product_id,label:t.product_id}})}))],1),t._v(" "),i("el-form-item",{attrs:{label:"code"}},[i("el-input",{attrs:{disabled:t.isEdit},model:{value:t.formItem.code,callback:function(e){t.$set(t.formItem,"code",e)},expression:"formItem.code"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"status"}},[i("el-select",{model:{value:t.formItem.status,callback:function(e){t.$set(t.formItem,"status",e)},expression:"formItem.status"}},[i("el-option",{attrs:{label:"fixed",value:0}}),t._v(" "),i("el-option",{attrs:{label:"open",value:1}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"level"}},[i("el-select",{model:{value:t.formItem.level,callback:function(e){t.$set(t.formItem,"level",e)},expression:"formItem.level"}},[i("el-option",{attrs:{label:"未定义",value:0}}),t._v(" "),i("el-option",{attrs:{label:"低",value:1}}),t._v(" "),i("el-option",{attrs:{label:"中",value:2}}),t._v(" "),i("el-option",{attrs:{label:"高",value:3}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"tip_type"}},[i("el-select",{model:{value:t.formItem.tip_type,callback:function(e){t.$set(t.formItem,"tip_type",e)},expression:"formItem.tip_type"}},[i("el-option",{attrs:{label:"弹窗交互",value:1}}),t._v(" "),i("el-option",{attrs:{label:"仅提示",value:2}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"push_rights"}},[i("el-select",{model:{value:t.formItem.push_rights,callback:function(e){t.$set(t.formItem,"push_rights",e)},expression:"formItem.push_rights"}},[i("el-option",{attrs:{label:"全员",value:0}}),t._v(" "),i("el-option",{attrs:{label:"户主",value:1}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"push_time"}},[t._l(t.formItem.push_time,function(e,a){return i("div",{key:a,staticClass:"push_time_item"},[i("el-time-select",{staticClass:"hour",attrs:{clearable:!1,"picker-options":t.getTimeSelectOption(a,0)},model:{value:t.formItem.push_time[a][0],callback:function(e){t.$set(t.formItem.push_time[a],0,e)},expression:"formItem.push_time[index][0]"}}),t._v(" -\n                    "),i("el-time-select",{staticClass:"hour",attrs:{clearable:!1,"picker-options":t.getTimeSelectOption(a,1)},model:{value:t.formItem.push_time[a][1],callback:function(e){t.$set(t.formItem.push_time[a],1,e)},expression:"formItem.push_time[index][1]"}}),t._v(" "),t.formItem.push_time.length>1?i("i",{staticClass:"el-icon-remove",on:{click:function(e){t.deleteRow(a)}}}):t._e()],1)}),t._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"mini"},on:{click:t.addRow}},[t._v("新增一行")])],2),t._v(" "),i("el-form-item",{attrs:{label:"push_type"}},[i("el-input",{model:{value:t.formItem.push_type,callback:function(e){t.$set(t.formItem,"push_type",e)},expression:"formItem.push_type"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"title"}},[i("el-input",{model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"des"}},[i("el-input",{attrs:{type:"textarea",rows:"2"},model:{value:t.formItem.des,callback:function(e){t.$set(t.formItem,"des",e)},expression:"formItem.des"}}),t._v(" "),i("span",[t._v("支持标签：${family_name},${room_name},${device_name}")])],1),t._v(" "),i("el-form-item",{attrs:{label:"revover_desc"}},[i("el-input",{attrs:{type:"textarea",rows:"2"},model:{value:t.formItem.revover_desc,callback:function(e){t.$set(t.formItem,"revover_desc",e)},expression:"formItem.revover_desc"}})],1)],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交")]),t._v(" "),i("el-button",{on:{click:function(e){t.formVisible=!1}}},[t._v("取消")])],1)],1)],1)},n=[],r={render:a,staticRenderFns:n};e.a=r},nF2r:function(t,e,i){"use strict";var a=i("woOf"),n=i.n(a),r=i("Vo7i");e.a={data:function(){return{list:null,total:null,listLoading:!1,listQuery:{page:1,limit:15},formVisible:!1,isEdit:!1,typeList:[],manufacturerList:[],productList:[],formItem:{},brand_id:"",type_id:""}},computed:{dialogTitle:function(){return this.isEdit?"edit fault":"add fault"}},created:function(){},mounted:function(){this.refresh()},methods:{refresh:function(){this.getList(),this.getTypeList(),this.getManufacturerList()},getManufacturerList:function(){var t=this;Object(r.a)({url:"brand/select",method:"POST",data:{is_online:1}}).then(function(e){t.manufacturerList=e})},getTypeList:function(){var t=this;Object(r.a)({url:"product/parenttype_lists",method:"POST"}).then(function(e){t.typeList=e.list})},onBrandChange:function(t){this.brand_id=this.getBrandId(),this.formItem.product_id="",this.getProductList()},onTypeChange:function(t){this.type_id=t,this.formItem.product_id="",this.getProductList()},getBrandId:function(){var t=this,e=this.manufacturerList.filter(function(e){return e.manufacturer_name===t.formItem.manufacturer});return e.length?e[0].brand_id:""},getProductList:function(){var t=this;Object(r.a)({url:"admin/product_lists",method:"POST",data:{limit:999,parent_type_id:this.type_id?this.type_id:void 0,brand_id:this.brand_id?this.brand_id:void 0,search_type:1,page:1}}).then(function(e){t.productList=e.data})},getList:function(){var t=this;this.listLoading=!0;var e={limit:this.listQuery.limit,page:this.listQuery.page};Object(r.a)({url:"device/fault/lists",data:e}).then(function(e){t.list=e.data,t.total=e.total_page,t.listLoading=!1})},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},addFault:function(){this.isEdit=!1,this.formVisible=!0,this.formItem={push_time:[[]],product_id:""},this.brand_id="",this.type_id="",this.productList=[]},editFault:function(t,e){this.isEdit=!0,this.formVisible=!0,this.formItem=n()({},t,{push_time:this.setFormatTime(JSON.parse(t.push_time))}),t.manufacturer&&(this.brand_id=this.getBrandId()),t.cid&&(this.type_id=t.cid),this.getProductList()},deleteFault:function(t){var e=this;this.$confirm("删除后将不能恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.a)({url:"device/fault/del",method:"POST",data:{id:t.id}}).then(function(i){t.is_valid=0,e.$message({type:"success",message:"删除成功!"})})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},deleteRow:function(t){this.formItem.push_time.splice(t,1)},addRow:function(){this.formItem.push_time.push([])},setFormatTime:function(t){return t.map(function(t){return t.map(function(t){return t+="",t.indexOf(":")>0?t:(t>10?t:"0"+t)+":00"})})},getFormatTime:function(t){return t.map(function(t){return t.map(function(t){return t.indexOf(":")>0?parseInt(t.split(":")[0]):t})})},onSubmit:function(){var t=this,e=n()({},this.formItem,{push_time:this.getFormatTime(this.formItem.push_time),created_at:void 0,updated_at:void 0,is_valid:void 0});Object(r.a)({url:this.isEdit?"device/fault/edit":"device/fault/add",method:"post",data:e}).then(function(e){t.$message.success("操作成功！"),t.formVisible=!1,t.getList()})},getTypeTextById:function(t){var e=this.typeList.filter(function(e){return e.id===t});return e.length?e[0].name:t},getPushRightsText:function(t){return{0:"全员",1:"户主"}[t]},getTimeSelectOption:function(){return{start:"00:00",end:"23:00",step:"01:00"}}}}},ru9S:function(t,e,i){e=t.exports=i("FZ+f")(!0),e.push([t.i,".push_time_item[data-v-f776f52e]{margin-bottom:5px}.hour[data-v-f776f52e]{width:110px}","",{version:3,sources:["/Users/danyin/prj/PomeloHomeOpen_Sys/src/views/configManagement/deviceFault.vue"],names:[],mappings:"AACA,iCACE,iBAAmB,CACpB,AACD,uBACE,WAAa,CACd",file:"deviceFault.vue",sourcesContent:["\n.push_time_item[data-v-f776f52e] {\n  margin-bottom: 5px;\n}\n.hour[data-v-f776f52e] {\n  width: 110px;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=60.f8a926cff5162d21d8b0.js.map